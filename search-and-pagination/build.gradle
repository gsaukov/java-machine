plugins {
    id 'org.springframework.boot'
    id 'java'
}

apply plugin: "java"
apply plugin: "org.springframework.boot"
apply plugin: "io.spring.dependency-management"

group 'com.apps'
version '1.0'

sourceCompatibility = 17

repositories {
    mavenCentral()
}

dependencyManagement {
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
        mavenBom 'org.springframework.session:spring-session-bom:Bean-SR2'
    }
}

dependencies {
    implementation project(':misc')
    
    implementation "org.springframework.boot:spring-boot-starter-actuator"
    implementation "org.liquibase:liquibase-core"
    implementation "org.springframework.boot:spring-boot-starter-thymeleaf"
    implementation "org.springframework.boot:spring-boot-starter-data-jpa"
    implementation "org.springframework.cloud:spring-cloud-starter-zipkin"
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation "org.springframework.boot:spring-boot-starter-security"
    implementation "org.springframework.session:spring-session-data-redis"
    implementation "redis.clients:jedis:${jedisVersion}"
    implementation 'org.springframework.security:spring-security-oauth2-core'
    implementation "org.springframework.security:spring-security-oauth2-client:${springOauthClientVersion}"
    implementation "org.springframework.security.oauth:spring-security-oauth2:${springOauthVersion}"
    implementation "org.springframework.security:spring-security-jwt:${springJwtVersion}"
    implementation "org.springframework.cloud:spring-cloud-starter-task"
    implementation "javax.persistence:javax.persistence-api"
    implementation "org.springframework.cloud:spring-cloud-starter-netflix-eureka-client"
    implementation "org.springframework.data:spring-data-commons"
    implementation "org.springframework.data:spring-data-cassandra"

    implementation "org.cassandraunit:cassandra-unit-spring:${cassandraUnitVersion}"
    implementation "org.cassandraunit:cassandra-unit-shaded:${cassandraUnitVersion}"
    implementation "com.datastax.cassandra:cassandra-driver-core:${cassandraDriverCoreVersion}"
    implementation "com.datastax.cassandra:cassandra-driver-mapping:${cassandraDriverMappingVersion}"

    implementation "org.hectorclient:hector-core:${hectorCoreVersion}"
    implementation "io.dropwizard.metrics:metrics-core:${dropWizardMetricsCoreVersion}"
    implementation "org.jsoup:jsoup:${jsoupVersion}"
    implementation "org.joda:joda-money:${jodaMoneyVersion}"
    implementation "fr.dudie:nominatim-api:${nominatimApiVersion}"
    implementation "org.codehaus.jettison:jettison:1.4.1"

//    runtimeOnly "com.h2database:h2:${h2Version}"
    runtimeOnly "mysql:mysql-connector-java:${mySqlVersion}"
    testImplementation "org.springframework.boot:spring-boot-starter-test"
    testImplementation "org.testng:testng:${testngVersion}"

    annotationProcessor('org.hibernate:hibernate-jpamodelgen')
}

// comment this if it does not implementation and you do no use nginx as resource server (localhost:9020)
task copyResources (dependsOn: clean) {
//    delete '${nginxPath}html/static'
//
//    copy {
//        from './src/main/resources/static/'
//        into "${nginxPath}html/static"
//    }
//
//    delete '${nginxPath}conf/nginx.conf'
//
//    copy {
//        from './src/main/resources/'
//        into "${nginxPath}conf/"
//        include "nginx.conf"
//    }
}

compileJava.dependsOn copyResources

sourceSets {
    main { 
        java {
            srcDirs += ['src/resources']
            srcDirs += ['src/generated/java']
        }
    }
}

bootJar {
    mainClass = 'com.apps.searchandpagination.SearchDataApplication'
}

springBoot {
    mainClass = 'com.apps.searchandpagination.SearchDataApplication'
}

tasks.withType(JavaCompile) {
    options.generatedSourceOutputDirectory = file("src/generated/java")
}


task testng(type: Test) {
    useTestNG()
}

check.dependsOn testng