<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="http://localhost:9020/static/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="http://localhost:9020/static/css/font-awesome.css" rel="stylesheet">
    <link href="http://localhost:9020/static/css/custom.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/fontelloembedded.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/simplebar.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/ol.css"  rel="stylesheet" >
    <link href="http://localhost:9020/static/css/auto-complete.css"  rel="stylesheet" >

    <script src="../static/js/custom/AddressMap.js"></script>
    <script src="../static/js/custom/chart.js"></script>
    <script src="../static/js/custom/custom.js"></script>

    <script src="../static/js/external/jquery-3.3.1.min.js"></script>
    <script src="../static/js/external/popper.min.js" ></script>
    <script src="../static/js/external/bootstrap.min.js"></script>
    <script src="../static/js/external/simplebar.js"></script>
    <script src="../static/js/external/OpenLayers.js"></script>
    <script src="../static/js/external/OpenStreetMap.js"></script>
    <script src="../static/js/external/ol.js"></script>
    <script src="../static/js/external/auto-complete.js"></script>
    <script src="../static/js/external/d3.v5.js"></script>

    <script>L_PREFER_CANVAS=false; L_NO_TOUCH=false; L_DISABLE_3D=false;</script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.3.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>

</head>

<body>
<button class="randomize">randomize</button>
<div id="domainperformance" style=""></div>
<style>

    svg {
        width: 1300px;
        height: 1000px;
        /*font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;*/
        position: relative;
    }

    path.slice{
        stroke-width:2px;
    }

    polyline{
        opacity: .3;
        stroke: white;
        stroke-width: 2px;
        fill: none;
    }

</style>

<script>

    var svg = d3.select('#domainperformance')
        .append("svg")
        .append("g")

    svg.append("g")
        .attr("class", "slices");
    svg.append("g")
        .attr("class", "labels");
    svg.append("g")
        .attr("class", "lines");

    var width = 1300,
        height = 1000,
        radius = Math.min(width, height) / 2;

    var pie = d3.pie()
        .sort(null)
        .value(function (d) {
            return d.value;
        });

    var arc = d3.arc()
        .outerRadius(radius * 0.8)
        .innerRadius(radius * 0.4);

    var outerArc = d3.arc()
        .innerRadius(radius * 0.9)
        .outerRadius(radius * 0.9);

    svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var key = function (d) {
        return d.data.label;
    };

    d3.select(".randomize")
        .on("click", function () {
            PieChart.fill(PieChart.randomData());
        });

    let PieChart = {
        colors : ["#D2B7ED", "#e4a0d7", "#DB84CB", "#AE88D6", "#ff4cb4", "#6178e5", "#ae73d5", "#ffc800", "#ff953d",
            "#C19FE3", "#D5D2F6", "#f2e700", "#ff5095", "#d285ce", "#a4a8f0", "#bb77d3", "#f5d6ee", "#7a6cdd", "#c77bd0",
            "#ffb80d", "#ff6573", "#eeedfc", "#ed50c2", "#F0E4FB", "#d555ce", "#b388d5", "#ffffff", "#9a61dd", "#c386d3",
            "#b7b9f3", "#FCE3F7", "#dcdbf9", "#b95bd7", "#ff8450", "#4169e1", "#c386d3", "#7466e1", "#F7CCEF", "#7988e9",
            "#ffd800", "#d27fcd", "#626adf", "#f1c9e8", "#ddf60d", "#8f98ec", "#C0BCEE", "#ff7461", "#cacaf6", "#8e6edb",
            "#ABA5E5", "#9f70d8"],

        // var labels = ["Lorem ipsum", "dolor sit", "amet", "consectetur", "adipisicing", "elit", "sed", "do", "eiusmod", "tempor"];


        // [
        //     {"label":"Loremipsum","value":12},
        //     {"label":"dolorsit","value":8},
        //     {"label":"amet","value":6},
        //     {"label":"consectetur","value":11},
        //     {"label":"adipisicing","value":22},
        //     {"label":"elit","value":33},
        //     {"label":"sed","value":17},
        //     {"label":"do","value":44},
        //     {"label":"eiusmod","value":15},
        //     {"label":"tempor","value":27}
        //     ]

        jsonData : '[{"label":"Loremipsum","value":12},{"label":"dolorsit","value":8},{"label":"amet","value":6},{"label":"consectetur","value":11},{"label":"adipisicing","value":22},{"label":"elit","value":33},{"label":"sed","value":17},{"label":"do","value":44},{"label":"eiusmod","value":15},{"label":"tempor","value":27}]',

        randomData : function () {
            let rawData = JSON.parse(this.jsonData);
            let length = this.colors.length;
            let randomStart = Math.floor(Math.random() * length);
            return rawData.map(function (entry, index) {
                return {label: entry.label, value: Math.random(), color: PieChart.colors[(index + randomStart) % length]}
            });
        },

        fill: function (data) {

            /* ------- PIE SLICES -------*/
            let slice = svg.select(".slices").selectAll("path.slice")
                .data(pie(data), key);

            slice.enter()
                .insert("path")
                .attr("class", "slice")
                .style("fill", function(d) { return d.data.color; })
                .merge(slice)
                .transition().duration(1000)
                .attrTween("d", function (d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function (t) {
                        return arc(interpolate(t));
                    };
                });

            slice.exit()
                .remove();

            /* ------- TEXT LABELS -------*/

            var text = svg.select(".labels").selectAll("text")
                .data(pie(data), key);

            function midAngle(d) {
                return d.startAngle + (d.endAngle - d.startAngle) / 2;
            }

            text.enter()
                .append("text")
                .attr("dy", ".35em")
                .style("stroke", "white")
                .style("fill", "white")
                .text(function (d) {
                    return d.data.label;
                })
                .merge(text)
                .transition().duration(1000)
                .attrTween("transform", function (d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function (t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                        return "translate(" + pos + ")";
                    };
                })
                .styleTween("text-anchor", function (d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function (t) {
                        var d2 = interpolate(t);
                        return midAngle(d2) < Math.PI ? "start" : "end";
                    };
                });
            text.exit()
                .remove();

            /* ------- SLICE TO TEXT POLYLINES -------*/

            var polyline = svg.select(".lines").selectAll("polyline")
                .data(pie(data), key);

            polyline.enter()
                .append("polyline")
                .merge(polyline)
                .transition().duration(1000)
                .attrTween("points", function (d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function (t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                        return [arc.centroid(d2), outerArc.centroid(d2), pos];
                    };
                });

            polyline.exit()
                .remove();
        }
    }

    PieChart.fill(PieChart.randomData());
</script>

</body>
</html>