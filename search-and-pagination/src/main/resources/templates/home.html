<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="../static/css/font-awesome.css" rel="stylesheet">
    <link href="../static/css/custom.css" rel="stylesheet" />
    <link href="../static/css/fontelloembedded.css" rel="stylesheet" />
    <link href="../static/css/simplebar.css" rel="stylesheet" />
    <link href="../static/css/ol.css"  rel="stylesheet" >
    <link href="../static/css/auto-complete.css"  rel="stylesheet" >


    <script src="../static/js/jquery-3.3.1.min.js"></script>
    <script src="../static/js/popper.min.js" ></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/simplebar.js"></script>
    <script src="../static/js/AddressMap.js"></script>
    <script src="../static/js/OpenLayers.js"></script>
    <script src="../static/js/OpenStreetMap.js"></script>
    <script src="../static/js/ol.js"></script>
    <script src="../static/js/auto-complete.js"></script>

</head>

<body>
<div id="wrapper" class="toggled">

     <!--Sidebar-->
    <div id="sidebar-wrapper">
    <ul class="sidebar-nav">
    <li class="sidebar-brand">
    <a href="#" onclick="$('#wrapper').toggleClass('toggled')">
    Start Bootstrap<i class="fas fa-chevron-left"></i>
    </a>
    </li>
    <li>
    <a href="#">Dashboard</a>
    </li>
    <li>
    <a href="#" onclick="getHome('accounthome/')">Accounts</a>
    </li>
    <li>
    <a href="#" onclick="getHome('tradehome/')">Trades</a>
    </li>
    <li>
    <a href="#">Events</a>
    </li>
    <li>
    <a href="#">About</a>
    </li>
    <li>
    <a href="#">Services</a>
    </li>
    <li>
    <a href="#">Contact</a>
    </li>
    </ul>
    </div>

<!--    <div id="page-content-wrapper" style="padding: 0px">-->
<!--        <div class="container-fluid" style="padding: 0px; padding-right: 1px;">-->
<!--            <div style="padding-left: 20px; padding-top: 15px;" >-->
<!--                <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Menu</a>-->
<!--                <a href="#collapseOne" class="btn btn-default" for="collapseOne" data-toggle="collapse" aria-expanded="false" aria-controls="collapseOne">Form</a>-->
<!--                <a href="#collapseTwo" class="btn btn-default" for="collapseTwo" data-toggle="collapse" aria-expanded="false" aria-controls="collapseTwo">Data</a>-->
<!--            </div>-->
<!--            <div id="homeBlock">-->
<!--                <div th:fragment="home(file, fragment)">-->
<!--                    <div th:replace="${file} :: ${fragment}"></div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
</div>

<div id="detailsTableBlock"></div>
<div id="mapBlock"></div>
<div id="detailsBlock"></div>

<div th:replace="modal :: modal"></div>

<textarea id="symbols" placeholder="Symbols comma separated" class="form-control" onclick="createAutoComplete('getallsymbols', 'symbols', allSymbolsObj)" style="height: 3em; width: 22em; margin-right: 10px;"></textarea>


<script>

    var allSymbolsObj = {
        allSymbolsData : ["UFY","KSDE","FIU","FIV","DEU","SCE","LMVL","YOJ","LMVP","LVI","NZL","JRI","UGS","BBD","PMJQ","UELC","JRQ","TFQH","JRS","PBUO","WLA","HNT","WLC","BLRY","VYPV","DFV","GOIV","SDF","WLI","ZHCJ","GSRC","JSF","YPW","BCF","JSN","LWQ","HXYR","FKQ","WMB","JSX","FKV","YQJ","QAD","UIK","QJCB","JTC","AGMA","GSSC","ESYM","HPJ","JENW","CECG","LXO","DHO","SNEW","TFSP","FNLT","YRI","SEU","ONRF","DHX","BDV","WNK","IYZC","SCPZ","WNS","BED","AEJH","DIH","UJV","XJPB","HQP","PZGM","BET","SGF","XFHS","PORN","HANR","IHYZ","MWKC","AGOL","KHSZ","MSCA","YTA","BFK","OFCT","WPD","HRY","YTO","GDXV","DKB","QPRP","BGD","WQB","FLKN","JERA","YUD","UMD","RSVE","NINE","OAD","JXB","YKQT","JIZQ","IMDW","HTVB","UMN","QEK","FPF","YTCD","JRLC","BHK","WRE","DLS","QFA","SJC","EIIS","QFD","LKYJ","MFLC","WRJ","IDTG","SRRG","ZLQT","YVT","JYG","ZHIR","BIB","BLYN","AENI","EKNI","MDHR","YCBZ","JTQL","HPON","YWF","JYX","OCA","WSK","UESS","HARJ","LIVL","OCG","MFMJ","UOQ","DNB","OLSN","VQHF","XJTZ","DNF","SKT","DSAQ","QGU","LZXK","STWX","DNN","DNO","KHXA","WTB","WTF","CKUY","SLE","PXHO","ZLSV","FSE","WTU","DLUK","HWM","ODU","UPY","DOO","BKN","RBXN","ODY","QFBT","YYF","SMA","UQF","UQI","DUGD","OED","WUM","FTA","ZHLT","ANBL","WUU","BOAM","QIS","SJEI","DPK","ZWIP","YVKP","URA","NCFW","WVF","WTMY","DPX","AXWM","HYA","RMOE","OUGV","BMB","YZG","NISW","QKA","JLEM","XFPO","QKH","XYVC","QKL","MCK","BYWW","QKT","MCR","LCNU","MCT","LTPI","HZT","ZUHQ","EMWY","DRY","JRRV","MDC","MDE","XHUU","SPO","MDJ","ZWMK","MDU","QLZ","QLRW","SQE","WYK","SQH","OII","UCUW","OIM","KAK","OIO","KAM","BPF","GIKB","IOQD","SQV","OIS","TMLO","FYMX","FXP","WGXE","WXYT","FXU","SRB","UUY","BOFC","UVN","FYD","IKIX","QLTO","FYK","BQJ","FYQ","NGSZ","KBY","WLBQ","DUX","ZHRM","YCKN","RGHB","QLUN","FZI","KCN","WAMZ","EXPV","QPB","SWED","ZBGD","FZZ","MHB","TMNX","UCXU","MDRG","UXN","QPN","ZHST","ZSIG","OLU","AVZC","GGJN","IQXT","QQI","PTIO","MMDO","SHIA","EPBE","MIK","KEM","ANJU","KET","SFEO","XWXZ","RTDE","OND","CCOU","TVBI","RGKA","WEXU","IBF","QRO","RZPV","APOP","GVIL","SUCP","LCUT","VOOV","HUDZ","SWG","TZKL","KGF","DOEL","MKV","GCEE","KKIE","DZT","WCVH","PTLG","XSRU","BVV","LASA","NRNO","OMAH","SXL","OPF","OPJ","RVJO","ZEH","OPO","IDO","KHQ","SXY","ALIV","EIXO","BWR","QUB","SXD","BWZ","GAB","IEE","FDKW","MMJ","XBU","RGNC","MMN","YNFZ","MMHY","KIP","SYW","BXL","NGZX","HWKT","KIX","XCE","TVFA","AYDJ","VXDB","XAH","QVH","ORK","HFJW","KJJ","BYD","UUAL","EVSS","FDMB","UHHH","ZDQZ","ZEJ","UNTW","IFZ","VZIA","MOE","ZHQ","HDGP","BOOK","BMKJ","IZPJ","WAUT","YRQB","KKN","IGN","WRWL","XEA","SDGP","GCW","ZIJ","YJAM","BZW","BSXH","MPD","ZIR","ALMF","NJBJ","KLG","WYEJ","TZPO","HUJJ","IHM","XMKG","BQTX","XFD","VBF","KMA","OUE","QYJ","LNQT","HJUY","GVPI","ENFF","TMXI","QYV","FYYU","KMQ","GEO","XGA","ULSQ","GEOK","EAW","XGM","NNLN","VIJZ","OBRD","HDJW","JLUD","HULT","ENGX","EBZ","CYCK","DBSU","GGC","ECF","JHMW","HQEI","XIFF","WPWQ","CLJX","GGX","ITHT","JBBO","OXN","XIV","ECTA","KMVB","TTHV","KPV","NAUS","EDS","JJSJ","EDX","KQB","KOZS","KQC","BIIA","OYJ","KQH","SBHV","VFT","MUG","MMPL","TBR","OYR","LUCD","CAI","SDMG","ZBTS","GIP","XXEJ","WYJZ","UWLN","ZOK","BIIY","ZON","VGM","DXAI","XKQ","INA","KRF","CBA","GCOV","NJHK","INO","OZW","BQZY","CBM","MVZ","ZPH","OZY","EFW","TDM","MQZT","KSI","LYMB","VHT","QQNR","RPIV","ZQC","EGO","QKBX","AFHT","CAYP","BXIJ","MXB","CFBX","RAG","GLA","LSAW","MXI","KRBZ","CDA","FSTH","HURF","MXN","EHG","DXCT","IPK","UDJC","ZIEA","MXX","XVDW","KTZ","MXIS","ZRN","RBG","IQE","TFT","ZQVF","ZZGO","ENNY","QBSV","RCG","VKK","XOO","GNB","GND","IRG","JBHP","KVK","TTNP","VKU","LFJU","KVQ","XXJO","KVT","ELKQ","KVX","MTCJ","EJV","VCGL","ZTL","MTCQ","QKFB","RDI","KWF","VLU","ISK","GAPY","ISN","CWGX","KWR","XQB","MEFY","KWX","CGS","ACR","GOY","ZUJ","ISZ","OMQM","KKYX","GPI","ITL","PAT","FMLI","PAV","VMZ","GPQ","KVOL","VIUL","CHP","KXX","VND","XRE","CHY","UWTJ","MEHL","XRW","HQOK","PBW","VCJB","KTLM","ZWB","DVEC","EFBU","KZG","IVG","IVH","MGMO","IPKA","RGS","ADKL","ENM","WHRG","XCEA","CDEM","ZXD","FQVY","ENY","XTL","SFZY","YDDL","SFZX","ZXS","NWJY","ZECQ","JMBY","VTMJ","TLT","EOH","CKF","UFUC","VPX","EOS","VQD","XRCU","GSZ","BRED","VIXW","KEQQ","IXM","IPMG","IXP","EPYS","NAY","CLQ","BVNC","NYPO","RJB","FGDO","BTJI","GUB","IYK","TNV","GUN","IYQ","AIM","XWF","DGKT","LJZI","MRFO","NQAP","TON","XWR","ERF","RLLM","VSZ","WHVC","UDTD","MZWR","UDTN","TPG","KVUZ","RLJ","TPN","NDK","QEBD","NDM","GFAZ","COE","TRSK","ESL","XXV","ZVIO","MTLH","XVOU","CLZW","NUKL","EHLS","OXNO","QZLO","RME","RMI","LAF","VUR","KNFZ","GXI","WFTA","ETN","SBXH","CWQA","BGTX","ETX","TTYB","YSGV","LBH","GYF","TRS","EUK","JUYJ","PJV","IATZ","CDLL","YULU","QEDZ","GNTY","TATU","PYOU","FVGG","PKM","TST","NDLN","ELWL","ROY","WMCJ","SKKR","UQQT","GLQM","VXC","EJSS","PBBV","IAVJ","LDF","EWB","LDH","PUHU","AOA","CSH","PLW","ZZUQ","RLQU","TUA","YOBL","GJNM","LWYY","RQJ","UQSC","CTA","TJHD","VYV","JAP","EXM","NIX","IRYQ","VEYP","APW","LFC","RYLQ","VZP","PNL","VRSF","GDCW","RRQ","CUE","WSRI","HKOA","RFGI","PNU","EYL","FGMD","EYN","NJT","LQOC","QIPX","VCVM","GNXV","DXUH","POK","RSQ","HGGY","GJQB","LBRQ","RSU","LGV","NSNG","HMTQ","RHLY","TXH","YAM","CVY","CVZ","WZAA","YAL","YAT","SOXI","CWC","PPO","NLP","AIAM","JDN","IJLA","QXPA","ASK","FZTY","LHW","HCAD","LIAB","XNGR","LID","BNIH","HAD","TYU","OCMQ","MRQG","GSDT","ATP","LIZ","GWLX","VRVU","JEW","YCN","TZL","TZN","ZGUT","ZEQD","RDGH","QCHS","AUW","LICI","CMFD","LOOU","YDU","NOJ","QTJV","MLFX","IUDJ","YEA","IDCC","TWHB","IUDV","WAN","PTJ","HMXZ","BTXN","HXNI","LLM","LLR","SGLK","YUVN","AWM","POEG","PUF","LME","RYH","PUQ","FAH","AXE","QEOG","WKIB","HVKN","JIQ","PUW","NQZ","LMNG","FAV","JIZ","HEZ","KNSK","LIFE","QVQF","YGO","XPPT","HFB","IFIQ","OEVE","FBD","FBE","FPFF","ISCC","MRUY","RZZ","VPWO","CQQW","AYM","OTTD","PDQQ","AVAD","JKQJ","NKEB","RWQH","UMTW","YHM","GHTU","LOF","YOLK","LGCQ","HGI","JKK","FXWQ","GOBF","LKKZ","EFWE","GWRT","PWZ","QNBY","YIB","JKW","JKX","PWP","SEKO","WEE","IHOK","FCY","WEJ","AZW","YOMP","UAB","QIZC","YIH","NTI","PXS","IQAE","WMPE","YUZI","HRFP","LPY","HHU","FGWL","WFG","MYEM","NMKI","YJN","YKFS","IHPQ","UCBU","LQH","IYRG","NUM","HIH","WFT","WFX","WFZ","JMT","AGFS","HIU","FEW","ZCUF","LRC","WGP","NVI","WGEW","BPVR","LRP","UCZ","PZT","JNR","HJR","DBO","JNW","PFYW","KYMT","YIDI","DBV","HAGF","LSA","JIQJ","UDH","VFGQ","YSXY","VJOW","WGFP","EKDB","UXNS","JOP","YZFP","NWY","HKU","YMF","SAK","IHST","QPKN","BHHG","HLI","TJWF","GHZD","JPT","YMY","WJC","ORVE","HLW","UFE","SBD","KFJH","NYF","HEQQ"],

        separator : ',',
        minChars : 2,
        // allSymbolsData : null,

        getData : function () {
            return this.allSymbolsData;
        },

        setData : function (data) {
            this.allSymbolsData =  JSON.parse(data);
        }
    }

    function createAutoComplete(url, targetId, dataObj) {
        window.event.preventDefault();
        if (dataObj.getData() === null) {
            var onResponse = function (response) {
                dataObj.setData(response);
            }

            doFetch(url, "GET", null, onResponse);

            new autoComplete({
                selector: 'textarea[id="' + targetId +'"]',
                minChars: 2,
                source: function (term, suggest) {
                    term = term.toLowerCase();
                    var choices = dataObj.getData();
                    var matches = [];
                    for (i = 0; i < choices.length; i++)
                        if (~choices[i].indexOf(term.toUpperCase())) matches.push(choices[i]);
                    suggest(matches);
                }
            });
        }

        new autoComplete({
            selector: 'textarea[id="' + targetId +'"]',
            minChars: dataObj.minChars,
            separator: dataObj.separator,
            cache: false,
            source: function (term, suggest) {
                var choices = dataObj.getData();
                var matches = [];
                term = term.toUpperCase().split(dataObj.separator).pop(-1).trim();
                if(term.length < dataObj.minChars) return;
                for (i = 0; i < choices.length; i++)
                    if (~choices[i].toUpperCase().indexOf(term)) matches.push(choices[i]);
                suggest(matches);
            },
            onAssign: function(that, v){
                if(dataObj.separator){
                    var tempVal = that.value;
                    if(tempVal.includes(dataObj.separator)){
                        tempVal = tempVal.substr(0, tempVal.lastIndexOf(dataObj.separator) + 1);
                        that.value = tempVal + v;
                    } else {
                        that.value = v;
                    }
                } else {
                    that.value = v;
                }
            }
        });
    }
</script>

<script>
    function showModal(label, body, options) {
        $('#modalWindow').data('bs.modal', null); //clear previous data if any.
        $('#modalWindowLabel').html(label);
        $('#modalWindowBody').html('');
        $('#modalWindowBody').append("<div id='modalWindowBodyScroll' style='width: 400px; max-height: 500px; padding-right: 17px'><\/div>");
        $('#modalWindowBodyScroll').html(body);
        new SimpleBar(document.getElementById('modalWindowBodyScroll'));
        if(options !== undefined && options.dataBackdrop !== undefined){
            $('#modalWindow').modal({backdrop: options.dataBackdrop});
        } else {
            $('#modalWindow').modal({backdrop: 'static'});
        }
        $('#modalWindow').modal('show');
    }
</script>

<script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script>

<script>
    function submitForm(e, formId, targetId) {
        var form = document.getElementById(formId);
        var table = document.getElementById(targetId);
        e.preventDefault();

        if (form.reportValidity()) { //proceed only if form is valid.
            var onResponse = function(response) {
                $(table).replaceWith(response);
            }
            doFetch($(form).attr('action'), $(form).attr('method'), buildData($(form).get(0)), onResponse);
        }
    }
</script>

<script>
    var existingDetailsTableId = null;

    function getAccountTrades(accountId) {
        window.event.preventDefault();
        var divId = 'accountTrades' + accountId;
        var url = '/tradesearch';
        var data = new FormData();
        data.append('accounts', accountId);
        data.append('order', 'DATE');
        data.append('itemsSize', '5');
        data.append('tableId', 'tradedatateble' + accountId);

        var divElem = document.getElementById(divId);
        if (divElem === null) {

            var onResponse = function (text) {
                removeDetailsTable(existingDetailsTableId);
                var detailsTableBlock = document.getElementById('detailsTableBlock');
                $(detailsTableBlock).append("<div id=\"" + divId + "\"><\/div>");
                var target = document.getElementById(divId);
                $(target).append("<a href='#' class='btn btn-default btn-close' onclick=\"removeDetailsTable('" + divId + "')\" style='position: absolute; right: 20px; z-index: 1000;'>&times;</a>");
                $(target).append(text);
                existingDetailsTableId = divId;
            }

            doFetch(url, "POST", data, onResponse);
        }
    }
</script>

<script>
    function getHome(urlParam) {
        window.event.preventDefault();
        $("#wrapper").toggleClass("toggled");

        var onResponse = function (response) {
            $("#homeBlock").html(response);
        }

        doFetch(urlParam, "GET", null, onResponse);
    }
</script>

<script>
    function getTable(tableId, urlParam, pageNum, size) {
        window.event.preventDefault();
        var url = urlParam + '&page=' + pageNum + '&size=' + size;

        var onResponse = function (response) {
            var target = document.getElementById(tableId);
            $(target).html(response);
        }

        doFetch(url, "GET", null, onResponse);
    }
</script>

<script>
    function getDetails(urlParam, detailId) {
        window.event.preventDefault();
        var url = urlParam + '/?detailId=' + detailId;
        var divElem = document.getElementById(detailId);

        if (divElem === null) {
            var onResponse = function (response) {
                $('#detailsBlock').append("<div id=\"" + detailId + "\"><\/div>");
                var target = document.getElementById(detailId);
                $(target).html(response);
            }

            doFetch(url, "GET", null, onResponse);
        }
    }
</script>

<script>
    function removeDetails(detailId) {
        window.event.preventDefault();
        var divId = "#" + detailId;
        $(divId).fadeOut("normal", function() {
            $(this).remove();
        });
    }
</script>

<script>
    function removeDetailsTable(tableId) {
        var divId = "#" + tableId;
        var first = $(divId).firstElementChild;
        while (first) {
            first.remove();
            first = e.firstElementChild;
        }
        $(divId).remove();
        existingDetailsTableId = null
    }
</script>

<script>
    function doFetch(url, method, data, onResponse, extraDetails) {
        var responseStatus;
        var responseStatusText;
        window.event.preventDefault();
        fetch(url, {
            method: method,
            body: data,
        }).then(
            function(response){
                return doCall(response, {url: url, method: method, data: data});
            }
        ).then(
            function(responseBody) {
                return doResponse(responseBody, onResponse, extraDetails);
            }
        ).catch(function(error) {
            showModal("Error", "<p>" + error.stack + "</p>" + "<p>" + error.message + "</p>");
        });
    }

    function buildData(formElement) {
        const data = new URLSearchParams();
        for (const pair of new FormData(formElement)) {
            data.append(pair[0], pair[1]);
        }
        return data;
    }

    function doCall(response, request) {
        responseStatus = response.status;
        responseStatusText = response.statusText;
        if(response.ok) {
            return response.text();
        } else {
            return response.text() // return the result of the inner promise, which is an error
                .then((text) => {
                    var errorDesc = "<p> URL: " + request.url + "<br> METHOD: " + request.method + "<br> DATA: " + request.data + "</p>"
                        + "<p>RESPONSE STATUS: " + responseStatus + " " + responseStatusText + "</p>"
                        + "<p>RESPONSE BODY: " + text + "</p>";
                    throw new Error(errorDesc);
                });
        }
    }

    function doResponse(text, onResponse, extraDetails) {
        if (extraDetails === undefined) {
            onResponse(text);
        } else {
            onResponse(text, extraDetails);
        }
    }
</script>

</body>
</html>