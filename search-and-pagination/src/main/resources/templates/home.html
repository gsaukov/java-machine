<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="http://localhost:9020/static/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="http://localhost:9020/static/css/font-awesome.css" rel="stylesheet">
    <link href="http://localhost:9020/static/css/custom.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/fontelloembedded.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/simplebar.css" rel="stylesheet" />
    <link href="http://localhost:9020/static/css/ol.css"  rel="stylesheet" >
    <link href="http://localhost:9020/static/css/auto-complete.css"  rel="stylesheet" >

    <script src="http://localhost:9020/static/js/custom/AddressMap.js"></script>
    <script src="http://localhost:9020/static/js/custom/chart.js"></script>
    <script src="http://localhost:9020/static/js/custom/custom.js"></script>

    <script src="http://localhost:9020/static/js/external/jquery-3.3.1.min.js"></script>
    <script src="http://localhost:9020/static/js/external/popper.min.js" ></script>
    <script src="http://localhost:9020/static/js/external/bootstrap.min.js"></script>
    <script src="http://localhost:9020/static/js/external/simplebar.js"></script>
    <script src="http://localhost:9020/static/js/external/OpenLayers.js"></script>
    <script src="http://localhost:9020/static/js/external/OpenStreetMap.js"></script>
    <script src="http://localhost:9020/static/js/external/ol.js"></script>
    <script src="http://localhost:9020/static/js/external/auto-complete.js"></script>
    <script src="http://localhost:9020/static/js/external/d3.v5.js"></script>

    <script>L_PREFER_CANVAS=false; L_NO_TOUCH=false; L_DISABLE_3D=false;</script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.3.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>

<!--    http://bl.ocks.org/enjalot/raw/211bd42857358a60a936/-->
<!--    https://blockbuilder.org/search?d3version=v5-->
<!--    https://blockbuilder.org/mbostock/1550e57e12e73b86ad9e-->
<!--    https://blockbuilder.org/officeofjane/8092eaec170663cadea5da1647ca77aa-->
<!--    https://blockbuilder.org/officeofjane/e394185b0e0998b5c7236f08f92c560f-->
<!--    https://blockbuilder.org/seemantk/e7fb1380c6de4d07ef24dba182f57a7e-->
<!--    https://blockbuilder.org/giorgi-ghviniashvili/e961128f71c0a927a9f50816ab61de43-->
    <!--https://jsfiddle.net/ngati016/Lo7v9jhc/?utm_source=website&utm_medium=embed&utm_campaign=Lo7v9jhc-->

</head>

<body>
<div id="blurBackGround">
    <div id="wrapper" class="toggled">

         <!--Sidebar-->
        <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
        <li class="sidebar-brand">
        <a href="#" onclick="$('#wrapper').toggleClass('toggled')">
        Start Bootstrap<i class="fas fa-chevron-left"></i>
        </a>
        </li>
        <li>
        <a href="#">Dashboard</a>
        </li>
        <li>
        <a href="#" onclick="getHome('accounthome/')">Accounts</a>
        </li>
        <li>
        <a href="#" onclick="getHome('tradehome/')">Trades</a>
        </li>
        <li>
            <div class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Cartography
                </a>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="#" onclick="buildCartography('originmap')">Origin</a>
                    <a class="dropdown-item" href="#" onclick="buildCartography('valuemap')">Value</a>
                    <a class="dropdown-item" href="#" onclick="buildCartography('pollutionmap')">Pollution</a>
                </div>
            </div>
        </li>
        <li>
        <a href="#">About</a>
        </li>
        <li>
        <a href="#">Services</a>
        </li>
        <li>
        <a href="#">Contact</a>
        </li>
        <li>
        <a href="/performlogout">Logout</a>
        </li>
        </ul>
        </div>

        <div id="page-content-wrapper" style="padding: 0px">
            <div class="container-fluid" style="padding: 0px; padding-right: 1px;">
                <nav class="navbar sticky-top navbar-expand-lg" style="background-color: rgba(11, 14, 22, .5); padding-left: 20px; padding-top: 15px;" >
                    <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Menu</a>
                    <a href="#collapseOne" class="btn btn-default" for="collapseOne" data-toggle="collapse" aria-expanded="false" aria-controls="collapseOne">Form</a>
                    <a href="#collapseTwo" class="btn btn-default" for="collapseTwo" data-toggle="collapse" aria-expanded="false" aria-controls="collapseTwo">Data</a>
                    <div th:replace="requesttimer :: requesttimer"></div>
                </nav>
                <div id="homeBlock">
                    <div th:fragment="home(file, fragment)">
                        <div th:replace="${file} :: ${fragment}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="detailsTableBlock"></div>
    <div id="mapBlock"></div>
    <div id="detailsBlock"></div>

    <div th:replace="modal :: modal"></div>
</div>
<div th:replace="account/accountperformance :: accountperformance"></div>
<div th:replace="cartography/cartography :: cartography"></div>

<script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
</script>

<script>
    function submitForm(e, formId, targetId) {
        let form = document.getElementById(formId);
        let table = document.getElementById(targetId);
        e.preventDefault();

        if (form.reportValidity()) { //proceed only if form is valid.
            let onResponse = function(response) {
                $(table).replaceWith(response);
            }
            doFetch($(form).attr('action'), $(form).attr('method'), buildData($(form).get(0)), onResponse);
        }
    }
</script>

<script>
    let existingDetailsTableId = null;

    function getAccountTrades(accountId, csrfParameterName, csrfToken) {
        window.event.preventDefault();
        let divId = 'accountTrades' + accountId;
        let url = 'tradesearch/';
        let data = new FormData();
        data.append(csrfParameterName, csrfToken);
        data.append('accounts', accountId);
        data.append('order', 'DATE');
        data.append('itemsSize', '5');
        data.append('tableId', 'tradedatateble' + accountId);

        let divElem = document.getElementById(divId);
        if (divElem === null) {

            let onResponse = function (text) {
                removeDetailsTable(existingDetailsTableId);
                let detailsTableBlock = document.getElementById('detailsTableBlock');
                $(detailsTableBlock).append("<div id=\"" + divId + "\"><\/div>");
                let target = document.getElementById(divId);
                $(target).append("<a href='#' class='btn btn-default btn-close' onclick=\"removeDetailsTable('" + divId + "')\" style='position: absolute; right: 20px; z-index: 1000;'>&times;</a>");
                $(target).append(text);
                existingDetailsTableId = divId;
            }

            doFetch(url, "POST", data, onResponse);
        }
    }
</script>

<script>
    function getHome(urlParam) {
        window.event.preventDefault();
        $("#wrapper").toggleClass("toggled");

        let onResponse = function (response) {
            $("#homeBlock").html(response);
        }

        doFetch(urlParam, "GET", null, onResponse);
    }
</script>

<script>
    function getTable(tableId, urlParam, pageNum, size) {
        window.event.preventDefault();
        let url = urlParam + '&page=' + pageNum + '&size=' + size;

        let onResponse = function (response) {
            let target = document.getElementById(tableId);
            $(target).html(response);
        }

        doFetch(url, "GET", null, onResponse);
    }
</script>

<script>
    function getDetails(urlParam, detailId) {
        window.event.preventDefault();
        let url = urlParam + '/?detailId=' + detailId;
        let divElem = document.getElementById(detailId);

        if (divElem === null) {
            let onResponse = function (response) {
                $('#detailsBlock').append("<div id=\"" + detailId + "\"><\/div>");
                let target = document.getElementById(detailId);
                $(target).html(response);
            }

            doFetch(url, "GET", null, onResponse);
        }
    }
</script>

</body>
</html>